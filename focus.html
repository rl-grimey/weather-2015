<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<title>Focus & Context Weather</title>
	
	<style>
	svg {
	  font: 10px sans-serif;
	}

	.area {
	  fill: steelblue;
	  clip-path: url(#clip);
	}

	.axis path,
	.axis line {
	  fill: none;
	  stroke: #000;
	  shape-rendering: crispEdges;
	}

	.brush .extent {
	  stroke: #fff;
	  fill-opacity: .125;
	  shape-rendering: crispEdges;
	}
	</style>
</head>

<body>
	<script src="js/d3.js"></script>
	
	<script>
	var margin = {top: 10, right: 10, bottom: 100, left: 40},
		margin2 = {top: 430, right: 10, bottom: 20, left: 40},
		width = 960 - margin.left - margin.right,
		height = 500 - margin.top - margin.bottom,
		height2 = 500 - margin2.top - margin2.bottom; 
		
	var x = d3.time.scale().range([0, width]),
		x2 = d3.time.scale().range([0, width]),
		y = d3.scale.linear().range([height, 0]),
		y2 = d3.scale.linear().range([height2, 0]),
		color = d3.scale.linear().range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);
	
	var xAxis = d3.svg.axis().scale(x).orient("bottom"),
		xAxis2 = d3.svg.axis().scale(x2).orient("bottom"),
		yAxis = d3.svg.axis().scale(y).orient("left");
		

	var brush = d3.svg.brush().x(x2).on("brush", brushed);

	
	var record = d3.svg.area()
        .defined(function(d) { return d.averageMinTemp > 0; })
		.interpolate("monotone")
		.x(function(d) { return x(d.date); })
		.y0(function(d) { return y(+d.averageMinTemp); })
		.y1(function(d) { return y(+d.averageMaxTemp); });
		
	var record2 = d3.svg.area()
		.interpolate("monotone")
		.x(function(d) { return x2(d.date); })
		.y0(function(d) { return y2(+d.averageMinTemp); })
		.y1(function(d) { return y2(+d.averageMaxTemp); });
		
	var svg = d3.select("body").append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom);
		
	svg.append("defs").append("clipPath")
		.attr("id", "clip")
		.append("rect")
			.attr("width", width)
			.attr("height", height);	
	
	var focus = svg.append("g")
		.attr("class", "focus")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	var context = svg.append("g")
		.attr("class", "context")
		.attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");
	
		
	d3.csv("data/2015-scraped-IC.csv", function(data) {
		data.forEach(function(d) { 
			d.month = +d.month;
			d.day = +d.day;
			d.date = new Date(2015, d.month-1, d.day);
			/*
            d.maxTemp = +d.maxTemp;
            d.minTemp = +d.minTemp;
            d.averageMaxTemp = +d.averageMaxTemp;
            d.averageMaxTemp = +d.averageMinTemp;
            d.recordMaxTemp = +d.recordMaxTemp;
            d.recordMinTemp = +d.recordMinTemp; 
		});
	
		x.domain(d3.extent(data.map(function(d) { return d.date; })));
		y.domain([d3.min(data, function(d) { return d.recordMinTemp; }), d3.max(data, function(d) { return d.recordMaxTemp; })]);
		x2.domain(x.domain());
		y2.domain(y.domain());
	    color.domain(y.domain());
		
		focus.append("path")
			.datum(data)
			.attr("class", "area")
			.attr("d", record);
		focus.append("g")
		    .attr("class", "x axis")
		    .attr("transform", "translate(0," + height + ")")
		    .call(xAxis);
		focus.append("g")
			.attr("class", "y axis")
			.call(yAxis);
		
		context.append("path")
			.datum(data)
			.attr("class", "area")
			.attr("d", record2);
		context.append("g")
			.attr("class", "x axis")
			.attr("transform", "translate(0," + height2 + ")")
			.call(xAxis2);
		context.append("g")
			.attr("class", "x brush")
			.call(brush)
		  .selectAll("rect")
			.attr("y", -6)
			.attr("height", height2 + 7);
	});		
				
	function brushed() {
		x.domain(brush.empty() ? x2.domain() : brush.extent());
		focus.select(".area").attr("d", record);
		focus.select(".x.axis").call(xAxis);
	}
	</script>
</body>
